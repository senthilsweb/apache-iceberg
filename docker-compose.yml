services:
  nessie:
    image: ghcr.io/projectnessie/nessie:0.93.0
    container_name: nessie
    ports:
      - "19120:19120"
    environment:
      # ===========================================
      # Version Store - PostgreSQL (Neon)
      # ===========================================
      NESSIE_VERSION_STORE_TYPE: JDBC
      QUARKUS_DATASOURCE_JDBC_URL: jdbc:postgresql://${NEON_HOST}:5432/${NEON_DB}?sslmode=require
      QUARKUS_DATASOURCE_USERNAME: ${NEON_USER}
      QUARKUS_DATASOURCE_PASSWORD: ${NEON_PASS}
      
      # ===========================================
      # Iceberg REST Catalog - Warehouse Configuration
      # ===========================================
      NESSIE_CATALOG_DEFAULT_WAREHOUSE: warehouse
      NESSIE_CATALOG_WAREHOUSES_WAREHOUSE_LOCATION: s3://${R2_BUCKET}/warehouse
      
      # ===========================================
      # S3/R2 Object Storage Configuration
      # Direct credentials without URN secret mechanism
      # ===========================================
      NESSIE_CATALOG_SERVICE_S3_DEFAULT_OPTIONS_ENDPOINT: https://${R2_ACCOUNT_ID}.r2.cloudflarestorage.com
      NESSIE_CATALOG_SERVICE_S3_DEFAULT_OPTIONS_PATH_STYLE_ACCESS: "true"
      NESSIE_CATALOG_SERVICE_S3_DEFAULT_OPTIONS_REGION: auto
      
      # Direct credential configuration (BasicCredentials format)
      NESSIE_CATALOG_SERVICE_S3_DEFAULT_OPTIONS_ACCESS_KEY_NAME: ${R2_ACCESS_KEY}
      NESSIE_CATALOG_SERVICE_S3_DEFAULT_OPTIONS_ACCESS_KEY_SECRET: ${R2_SECRET_KEY}

    # Default CMD already runs "nessie serve"
